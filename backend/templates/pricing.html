<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pricing â€“ AI Audio Generator</title>

  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon-32.png') }}">

  <meta name="description"
        content="Choose a plan for AI Audio Generator. Starter, Creator and Pro plans with credits for text-to-speech.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="AI Audio Generator">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="auth-body">

<div class="auth-wrapper info-wrapper">
  <div class="auth-card about-card">

    <div class="auth-avatar">
      <div class="auth-avatar-icon">ðŸ’³</div>
    </div>

    <h2 class="auth-title">Pricing Plans</h2>
    <p class="auth-subtitle">
      New users get <strong>100 free credits</strong>. Each audio costs
      <strong>10 credits</strong>. Upgrade using the plans below.
    </p>

    <!-- Flash success message (from verify_payment) -->
    {% with messages = get_flashed_messages(with_categories=True) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="auth-error"
               style="border-color:#22c55e; color:#bbf7d0; background:rgba(34,197,94,0.08); margin-bottom:12px;">
            {{ msg }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="about-content">

      <div class="plans-row">
        <!-- Starter -->
        <div class="plan-card">
          <h3>Starter</h3>
          <p class="plan-tagline">Best for testing & casual use.</p>
          <p class="plan-credits"><strong>10,000 credits</strong></p>
          <p>Each audio uses 10 credits</p>
          <p class="plan-price"><strong>â‚¹299</strong> one time</p>

          <button type="button" class="auth-button plan-qr-btn"
                  onclick="startPayment('starter', 299)">
            Pay â‚¹299 & Activate
          </button>
        </div>

        <!-- Creator -->
        <div class="plan-card plan-card-highlight">
          <h3>Creator</h3>
          <p class="plan-tagline">Perfect for regular content creators.</p>
          <p class="plan-credits"><strong>20,000 credits</strong></p>
          <p>Each audio uses 10 credits</p>
          <p class="plan-price"><strong>â‚¹399</strong> one time</p>

          <button type="button" class="auth-button plan-qr-btn"
                  onclick="startPayment('creator', 399)">
            Pay â‚¹399 & Activate
          </button>
        </div>

        <!-- Pro -->
        <div class="plan-card">
          <h3>Pro</h3>
          <p class="plan-tagline">For heavy users & professionals.</p>
          <p class="plan-credits"><strong>30,000 credits</strong></p>
          <p>Each audio uses 10 credits</p>
          <p class="plan-price"><strong>â‚¹499</strong> one time</p>

          <button type="button" class="auth-button plan-qr-btn"
                  onclick="startPayment('pro', 499)">
            Pay â‚¹499 & Activate
          </button>
        </div>
      </div>

      <p style="margin-top:18px; font-size:0.9rem; color:#94a3b8;">
        Payments are processed securely via Razorpay (test mode while developing).
      </p>
    </div>

    <div style="margin-top: 16px;">
      <a href="{{ url_for('index') }}" class="about-back-btn">â¬… Back to Dashboard</a>
    </div>

  </div>
</div>

<!-- Razorpay checkout script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  function startPayment(planId, price) {
    // 1. Ask backend to create order
    fetch(`/create-order/${planId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    })
    .then(res => res.json())
    .then(orderData => {
      if (!orderData.order_id) {
        alert("Could not start payment. Try again.");
        return;
      }

      const options = {
        key: "{{ razorpay_key_id }}",
        amount: orderData.amount,
        currency: "INR",
        name: "AI Audio Generator",
        description: `Purchase ${planId} plan`,
        order_id: orderData.order_id,
        handler: function (response){
          // 2. After payment success, verify with backend
          fetch("/verify-payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              razorpay_payment_id: response.razorpay_payment_id,
              razorpay_order_id: response.razorpay_order_id,
              razorpay_signature: response.razorpay_signature,
              plan_id: planId
            })
          })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              alert("Payment successful! Credits added.");
              window.location.reload();
            } else {
              alert("Payment verification failed: " + data.message);
            }
          })
          .catch(err => {
            console.error(err);
            alert("Error verifying payment.");
          });
        },
        theme: {
          color: "#ff5e62"
        }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    })
    .catch(err => {
      console.error(err);
      alert("Error creating payment order.");
    });
  }
</script>

</body>
</html>
